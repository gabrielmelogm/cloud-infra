services:
  nginx:
    image: nginx:latest
    ports:
      - 80:80
    networks:
      - public
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: [ node.role == manager ]
      labels:
        - "traefik.enable=true"
        - "traefik.docker.network=public"
        - "traefik.http.routers.nginx.rule=Host(`nginx.gabrielmelo.shop`)"
        - "traefik.http.routers.nginx.entrypoints=websecure"
        - "traefik.http.routers.nginx.tls.certresolver=leresolver"
        - "traefik.http.routers.nginx.service=nginx"
        - "traefik.http.services.nginx.loadbalancer.server.port=80"
networks:
  public:
    external: true
    attachable: true